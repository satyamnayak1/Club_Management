<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Club Wallet - Home</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'Poppins',sans-serif;color:#6b7280;}
    h1,h2,h3,h4{font-weight:700;color:#111827;}
    h1{text-align:center;font-size:62px;}
    h3{font-size:32px;}
    button{background:none;border:none;padding:0;margin:0;font:inherit;color:inherit;cursor:pointer;}
    a{text-decoration:none;color:inherit;}
    .container{width:100%;}
    .nav-sec{padding:8px 16px;border-top:1px solid #9ca3af;border-bottom:1px solid #9ca3af;}
    .nav-bar{display:flex;justify-content:space-between;align-items:center;}
    .nav-set{display:flex;gap:40px;}
    .main{width:100%;min-height:600px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;}
    .balance-sec{display:flex;flex-direction:column;align-items:center;gap:30px;width:100%;}
    .balance{width:90%;max-width:600px;height:40px;border:1px solid black;background-color:white;display:flex;justify-content:space-between;align-items:center;padding:0 20px;border-radius:8px;}
    .balance-card{width:90%;display:flex;flex-wrap:wrap;gap:40px;justify-content:center;align-items:center;}
    .deposite-card, .withdraw-card{width:90%;max-width:500px;height:400px;display:flex;flex-direction:column;align-items:center;justify-content:space-evenly;border-radius:10px;}
    .deposite-card{background-color:#C8E2C0;}
    .withdraw-card{background-color:#E3DDC2;}
    .btn-balance{border:1px solid black;padding:10px 40px;border-radius:20px;font-weight:500;cursor:pointer;transition:all 0.3s ease;}
    .btn-balance:hover{background-color:rgba(0,0,0,0.1);}
    .section{width:100%;padding:40px 20px;max-width:1200px;margin:0 auto;}
    .transaction{display:flex;flex-direction:column;gap:20px;}
    .transaction-heading{text-align:center;margin-bottom:20px;font-size:28px;color:#111827;}
    .transaction-list{width:100%;min-height:80px;background-color:#f9fafb;border:1px solid #e5e7eb;border-radius:10px;padding:20px;display:flex;justify-content:space-between;align-items:center;transition:all 0.3s ease;}
    .transaction-list:hover{box-shadow:0 4px 6px rgba(0,0,0,0.1);transform:translateY(-2px);}
    .transaction-info{display:flex;flex-direction:column;gap:5px;}
    .transaction-reason{font-size:18px;font-weight:600;color:#111827;}
    .transaction-meta{font-size:14px;color:#6b7280;display:flex;gap:10px;align-items:center;}
    .transaction-amount{display:flex;flex-direction:column;align-items:flex-end;gap:5px;}
    .amount-value{font-size:24px;font-weight:700;}
    .amount-deposit{color:#16a34a;}
    .amount-withdraw{color:#dc2626;}
    .transaction-type{font-size:12px;padding:4px 12px;border-radius:12px;font-weight:500;text-transform:uppercase;}
    .type-deposit{background-color:#dcfce7;color:#16a34a;}
    .type-withdraw{background-color:#fee2e2;color:#dc2626;}
    .no-transactions{text-align:center;padding:40px;color:#6b7280;font-size:18px;}
    .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;}
    .modal-content{background:#fff;padding:30px;border-radius:12px;width:90%;max-width:400px;box-shadow:0 5px 15px rgba(0,0,0,0.3);animation:fadeIn 0.3s ease-in-out;}
    @keyframes fadeIn {from {opacity:0;transform:scale(0.9);} to {opacity:1;transform:scale(1);}}
    .close{float:right;font-size:28px;font-weight:bold;cursor:pointer;color:#6b7280;line-height:20px;}
    .close:hover{color:#111827;}
    .modal-content h3{margin-bottom:20px;clear:both;}
    .modal-content label{display:block;margin:10px 0 5px;font-weight:600;color:#111827;}
    .modal-content input{width:100%;padding:10px;margin-bottom:15px;border:1px solid #d1d5db;border-radius:6px;font-size:16px;}
    .modal-content button[type="submit"]{width:100%;padding:12px;background:#111827;color:white;border:none;border-radius:6px;cursor:pointer;font-size:16px;font-weight:600;transition:background 0.3s ease;}
    .modal-content button[type="submit"]:hover{background:#1f2937;}
  </style>
</head>
<body>
  <div class="container">

    <header class="nav-sec">
      <div class="nav-bar">
        <div><a href="">Logo</a></div>
        <ul class="nav-set">
          <li><button id="fund">Fund</button></li>
          <li><button>Event</button></li>
          <li><button>Show Members</button></li>
        </ul>
      </div>
    </header>

    <main class="main">
      <div class="balance-sec">
        <h3>Welcome to the Club Wallet</h3>
        <div class="balance">
          <span>Community Balance:</span>
          <span class="total-balance">₹0.00</span>
        </div>
        <div class="balance-card">
          <div class="deposite-card">
            <h3>Deposit Funds</h3>
            <button class="btn-balance" id="depositBtn">Deposit</button>
          </div>
          <div class="withdraw-card">
            <h3>Withdraw Funds</h3>
            <button class="btn-balance" id="withdrawBtn">Withdraw</button>
          </div>
        </div>
      </div>
    </main>

    <section class="section">
      <h2 class="transaction-heading">Recent Transactions</h2>
      <div class="transaction" id="transactionContainer">
        <div class="no-transactions">No transactions yet</div>
      </div>
    </section>

    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeWithdraw">&times;</span>
        <h3>Withdraw Funds</h3>
        <form id="withdraw-form">
          <label for="withdraw-reason">Reason:</label>
          <input type="text" id="withdraw-reason" name="reason" required>
          <label for="withdraw-amount">Amount:</label>
          <input type="number" id="withdraw-amount" name="amount" step="0.01" required>
          <button type="submit">Withdraw</button>
        </form>
      </div>
    </div>

    <!-- Deposit Modal -->
    <div id="depositModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeDeposit">&times;</span>
        <h3>Deposit Funds</h3>
        <form id="deposit-form">
          <label for="deposit-reason">Reason:</label>
          <input type="text" id="deposit-reason" name="reason" required>
          <label for="deposit-amount">Amount:</label>
          <input type="number" id="deposit-amount" name="amount" step="0.01" required>
          <button type="submit">Deposit</button>
        </form>
      </div>
    </div>

  </div>

  <script>
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleString('en-US', { year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit' });
    }

    function formatAmount(amount) {
      return `₹${parseFloat(amount).toFixed(2)}`;
    }

    function displayTransactions(transactions) {
      const container = document.getElementById('transactionContainer');
      if (!transactions || transactions.length === 0) {
        container.innerHTML = '<div class="no-transactions">No transactions yet</div>';
        return;
      }
      container.innerHTML = '';
      transactions.forEach(txn => {
        const div = document.createElement('div');
        div.className = 'transaction-list';
        const typeClass = txn.type === 'DEPOSITE' ? 'amount-deposit' : 'amount-withdraw';
        const typeLabel = txn.type === 'DEPOSITE' ? 'type-deposit' : 'type-withdraw';
        const sign = txn.type === 'DEPOSITE' ? '+' : '-';
        div.innerHTML = `
          <div class="transaction-info">
            <div class="transaction-reason">${txn.reason}</div>
            <div class="transaction-meta">${formatDate(txn.createdAt)}</div>
          </div>
          <div class="transaction-amount">
            <div class="amount-value ${typeClass}">${sign}${formatAmount(txn.amount)}</div>
            <span class="transaction-type ${typeLabel}">${txn.type}</span>
          </div>
        `;
        container.appendChild(div);
      });
    }

    async function showFund() {
      try {
        const token = localStorage.getItem("token");
        const res = await fetch("http://localhost:8081/showfund", {
          method:"GET",
          headers: { "Authorization": `Bearer ${token}` }
        });
        if(res.ok){
          const data = await res.json();
          document.querySelector('.total-balance').textContent = formatAmount(data.balance);
          displayTransactions(data.recentTransactions);
        } else alert("Failed to load fund");
      } catch(e){console.error(e); alert("Something went wrong");}
    }

    document.querySelector('#fund').addEventListener('click', showFund);

    const withdrawModal = document.getElementById("withdrawModal");
    const depositModal = document.getElementById("depositModal");
    document.getElementById("withdrawBtn").onclick = ()=> withdrawModal.style.display="flex";
    document.getElementById("depositBtn").onclick = ()=> depositModal.style.display="flex";
    document.getElementById("closeWithdraw").onclick = ()=> withdrawModal.style.display="none";
    document.getElementById("closeDeposit").onclick = ()=> depositModal.style.display="none";
    window.onclick = e=>{if(e.target===withdrawModal)withdrawModal.style.display="none"; if(e.target===depositModal)depositModal.style.display="none";}

    document.querySelector('#withdraw-form').addEventListener('submit', async e=>{
      e.preventDefault();
      const payload={amount: parseFloat(document.querySelector('#withdraw-amount').value), type:"WITHDRAW", reason: document.querySelector('#withdraw-reason').value};
      const token = localStorage.getItem("token");
      try{
        const res = await fetch("http://localhost:8081/fund",{method:"POST",headers:{"Content-Type":"application/json","Authorization":`Bearer ${token}`},body:JSON.stringify(payload)});
        if(res.ok){
          const data = await res.json();
          document.querySelector('.total-balance').textContent = formatAmount(data.balance);
          displayTransactions(data.recentTransactions);
          alert("Withdrawal successful"); withdrawModal.style.display="none"; document.querySelector('#withdraw-form').reset();
        } else alert("Error occurred");
      } catch(err){console.error(err); alert("Something went wrong");}
    });

    document.querySelector('#deposit-form').addEventListener('submit', async e=>{
      e.preventDefault();
      const payload={amount: parseFloat(document.querySelector('#deposit-amount').value), type:"DEPOSITE", reason: document.querySelector('#deposit-reason').value};
      const token = localStorage.getItem("token");
      try{
        const res = await fetch("http://localhost:8081/fund",{method:"POST",headers:{"Content-Type":"application/json","Authorization":`Bearer ${token}`},body:JSON.stringify(payload)});
        if(res.ok){
          const data = await res.json();
          document.querySelector('.total-balance').textContent = formatAmount(data.balance);
          displayTransactions(data.recentTransactions);
          alert("Deposit successful"); depositModal.style.display="none"; document.querySelector('#deposit-form').reset();
        } else alert("Error occurred");
      } catch(err){console.error(err); alert("Something went wrong");}
    });

    window.addEventListener('load', showFund);
  </script>
</body>
</html>
