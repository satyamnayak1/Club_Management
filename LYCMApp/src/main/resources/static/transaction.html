<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Club Wallet - Transactions</title>
  
  <style>
  *{
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  .container{
    width: 100%;
  }

  body{
    font-family: 'Poppins',sans-serif;
    font-weight: 400;
    line-height: 1.5;
    color: #6b7280;
  }

  p{
    text-align: center;
    font-size: 20px;
  }
  h1,h2,h3,h4{
    font-weight: 700;
    line-height: 1.2;
    letter-spacing: -2px;
    color:#111827;
  }
  h1{
    text-align: center;
    font-size: 62px;
  }
  h3{
    font-size: 32px;
  }

  a{
    text-decoration: none;
    font-size: 16px;
    display: inline-block;
  }
  ul{
    list-style: none;
  }
  button {
    background: none;
    border: none;
    padding: 0;
    margin: 0;
    font: inherit;
    color: inherit;
    cursor: pointer;
  }

  .nav-sec{
    padding: 8px 16px;
    border-top: 1px solid #9ca3af;
    border-bottom: 1px solid #9ca3af ;
  }
  .header{
    margin-top: 10px;
    margin-bottom: 60px;
  }
  .nav-bar{
    display: flex;
    justify-content: space-between;
    flex-direction: row;
  }
  .nav-align{
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    gap: 30px;
  }
  .nav-set{
    display: flex;
    flex-direction: row;
    gap: 40px;
  }
  .nav-svg{
    display: flex;
    gap: 20px;
    flex-direction: row;
  }
  .icon-btn{
    background: none;
    border: none;
    padding: 0;
    margin: 0;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  .icon-btn img {
    width: 24px;
    height: 24px;
  }

  .main{
    width: 100%;
    min-height: 600px;
    margin-bottom: 60px;
    padding: 40px 20px;
  }

  /* Transaction Section */
  .section{
    width: 100%;
    padding: 40px 20px;
    max-width: 1200px;
    margin: 0 auto;
  }
  
  .transaction-heading{
    text-align: center;
    margin-bottom: 30px;
    font-size: 28px;
    color: #111827;
  }

  .loading {
    text-align: center;
    padding: 2rem;
    font-size: 18px;
    color: #6b7280;
  }

  .error {
    background: #fee2e2;
    color: #991b1b;
    padding: 1rem;
    text-align: center;
    margin: 1rem 0;
    border-radius: 8px;
  }

  .transaction-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 2rem;
    background: white;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border-radius: 8px;
    overflow: hidden;
  }

  .transaction-table thead {
    background: #111827;
    color: white;
  }

  .transaction-table th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .transaction-table td {
    padding: 1rem;
    border-bottom: 1px solid #e5e7eb;
  }

  .transaction-table tbody tr {
    transition: background-color 0.2s;
  }

  .transaction-table tbody tr:hover {
    background: #f9fafb;
  }

  .type-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
  }

  .type-add {
    background-color: #dcfce7;
    color: #16a34a;
  }

  .type-withdraw {
    background-color: #fee2e2;
    color: #dc2626;
  }

  .amount-positive {
    color: #16a34a;
    font-weight: 600;
  }

  .amount-negative {
    color: #dc2626;
    font-weight: 600;
  }

  /* Pagination from dashboard.css */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  .pagination-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-top: 1px solid #e5e7eb;
    background-color: #fff;
    padding: 0.75rem 1rem;
    margin-top: 2rem;
    border-radius: 0 0 8px 8px;
  }

  .pagination-mobile {
    display: flex;
    flex: 1;
    justify-content: space-between;
  }

  .pagination-btn {
    position: relative;
    display: inline-flex;
    align-items: center;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    background-color: #fff;
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: #4b5563;
    text-decoration: none;
    cursor: pointer;
  }

  .pagination-btn + .pagination-btn {
    margin-left: 0.75rem;
  }

  .pagination-btn:hover {
    background-color: #f9fafb;
  }

  .pagination-desktop {
    display: none;
    flex: 1;
    align-items: center;
    justify-content: space-between;
  }

  .pagination-info {
    font-size: 0.875rem;
    color: #4b5563;
  }

  .pagination-info .font-medium {
    font-weight: 500;
  }

  .pagination-nav {
    display: inline-flex;
    border-radius: 0.375rem;
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  }

  .pagination-nav-item {
    position: relative;
    display: inline-flex;
    align-items: center;
    font-size: 0.875rem;
    font-weight: 600;
    padding: 0.5rem 1rem;
    color: #111827;
    border: 1px solid #d1d5db;
    background-color: #fff;
    text-decoration: none;
    z-index: 10;
    cursor: pointer;
  }

  .pagination-nav-item:hover {
    background-color: #f9fafb;
  }

  .pagination-nav-item:focus {
    z-index: 20;
    outline: 2px solid #4f46e5;
    outline-offset: -2px;
  }

  .pagination-nav-item.current-page {
    z-index: 10;
    background-color: #4f46e5;
    color: #fff;
    border-color: #4f46e5;
  }

  .pagination-nav-item.rounded-l {
    border-top-left-radius: 0.375rem;
    border-bottom-left-radius: 0.375rem;
  }

  .pagination-nav-item.rounded-r {
    border-top-right-radius: 0.375rem;
    border-bottom-right-radius: 0.375rem;
  }

  .pagination-nav-item:not(:first-child) {
    margin-left: -1px;
  }

  .pagination-ellipsis {
    position: relative;
    display: inline-flex;
    align-items: center;
    font-size: 0.875rem;
    font-weight: 600;
    color: #4b5563;
    padding: 0.5rem 1rem;
    border: 1px solid #d1d5db;
    z-index: 10;
  }

  .icon {
    width: 1.25rem;
    height: 1.25rem;
    color: #9ca3af;
  }

  .hidden-on-mobile {
    display: none;
  }

  @media (min-width: 640px) {
    .pagination-mobile {
      display: none;
    }

    .pagination-desktop {
      display: flex;
    }
  }

  @media (min-width: 768px) {
    .hidden-on-mobile {
      display: inline-flex;
    }
  }

  .footer{
    padding: 40px 20px;
    background-color: #f9fafb;
    margin-top: 60px;
  }
  .about{
    margin-bottom: 40px;
  }
  .logo-icon{
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }
  .icon-sec{
    display: flex;
    flex-direction: row;
    gap: 15px;
  }
  .social-icons{
    width: 25px;
    height: 25px;
  }

  @media (max-width: 768px) {
    h1{
      font-size: 42px;
    }
    h3{
      font-size: 24px;
    }
    .transaction-table {
      font-size: 14px;
    }
    .transaction-table th,
    .transaction-table td {
      padding: 0.75rem 0.5rem;
    }
    .logo-icon{
      flex-direction: column;
      gap: 20px;
    }
  }
  </style>
</head>
<body>
  <div class="container">

    <header class="header">
      <div class="nav-sec">
        <nav>
          <div class="nav-bar">
            <div class="nav-align">
              <div>
                <a href="">Logo</a>
              </div>
              <div>
                <ul class="nav-set">
                  <li><button>Fund</button></li>
                  <li><button>Event</button></li>
                  <li><button>Show Members</button></li>
                </ul>
              </div>
            </div>

            <div class="nav-align">
              <ul class="nav-svg">
                <li><button class="icon-btn"><img src="images/poutline.svg" alt=""></button></li>
                <li><button class="icon-btn"><img src="images/outline.svg" alt=""></button></li>
              </ul>
            </div>
          </div>
        </nav>
      </div>
    </header>

    <main class="main">
      <section class="section">
        <h2 class="transaction-heading">Transaction History</h2>
        
        <div id="loading" class="loading">Loading transactions...</div>
        <div id="error" class="error" style="display: none;"></div>

        <div id="transaction-content" style="display: none;">
          <table class="transaction-table">
            <thead>
              <tr>
                <th>Admin Name</th>
                <th>Amount</th>
                <th>Type</th>
                <th>Reason</th>
                <th>Date & Time</th>
              </tr>
            </thead>
            <tbody id="transaction-body">
            </tbody>
          </table>

          <!-- Pagination Container -->
          <div class="pagination-container">
            <!-- Mobile Pagination (visible on small screens) -->
            <div class="pagination-mobile">
              <a href="#" id="prev-mobile" class="pagination-btn">Previous</a>
              <a href="#" id="next-mobile" class="pagination-btn">Next</a>
            </div>

            <!-- Desktop Pagination (visible on larger screens) -->
            <div class="pagination-desktop">
              <div class="pagination-info">
                <p>
                  Showing <span class="font-medium" id="start-record">1</span> to 
                  <span class="font-medium" id="end-record">10</span> of 
                  <span class="font-medium" id="total-records">0</span> results
                </p>
              </div>
              <div>
                <nav class="pagination-nav" id="pagination-nav">
                  <!-- Pagination buttons will be inserted here -->
                </nav>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div class="cta-section">
        <div class="about">
          <p>Lion Youth Club, founded in 1995, is a community-based youth organization committed to empowering young people through sports,<br> cultural activities, and social service. For nearly three decades, it has served as a platform for growth and leadership,<br> encouraging the youth of the village to uphold traditions while contributing to modern development.</p>
        </div>

        <div class="logo-icon">
          <div>
            <p>Logo</p>
            <h4>Lion Youth Club</h4>
          </div>

          <div>
            <ul class="icon-sec">
              <li><a href=""><img src="images/facebook.svg" class="social-icons" alt="Facebook"></a></li>
              <li><a href=""><img src="images/instagram.svg" class="social-icons" alt="Instagram"></a></li>
              <li><a href=""><img src="images/youtube.svg" class="social-icons" alt="YouTube"></a></li>
              <li><a href=""><img src="images/twitter.svg" class="social-icons" alt="Twitter"></a></li>
              <li><a href=""><img src="images/whatsapp.svg" class="social-icons" alt="WhatsApp"></a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>

  </div>

  <script>
    // const API_BASE_URL = 'http://localhost:8080';
    // let currentPage = 0;
    // const pageSize = 10;

    // async function fetchTransactions(page) {
    //   try {
    //     document.getElementById('loading').style.display = 'block';
    //     document.getElementById('error').style.display = 'none';
    //     document.getElementById('transaction-content').style.display = 'none';

    //     const response = await fetch(`${API_BASE_URL}/transaction/${page}/${pageSize}`);
        
    //     if (!response.ok) {
    //       throw new Error(`HTTP error! status: ${response.status}`);
    //     }
        
    //     const data = await response.json();
        
    //     displayTransactions(data);
    //     createPagination(data);
        
    //     document.getElementById('loading').style.display = 'none';
    //     document.getElementById('transaction-content').style.display = 'block';
    //   } catch (error) {
    //     document.getElementById('loading').style.display = 'none';
    //     document.getElementById('error').style.display = 'block';
    //     document.getElementById('error').textContent = `Error loading transactions: ${error.message}`;
    //     console.error('Error fetching transactions:', error);
    //   }
    // }

    // function displayTransactions(data) {
    //   const tbody = document.getElementById('transaction-body');
    //   tbody.innerHTML = '';

    //   if (data.content.length === 0) {
    //     tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 2rem;">No transactions found</td></tr>';
    //     return;
    //   }

    //   data.content.forEach(transaction => {
    //     const row = document.createElement('tr');
        
    //     const typeClass = transaction.type === 'ADD' ? 'type-add' : 'type-withdraw';
    //     const amountClass = transaction.type === 'ADD' ? 'amount-positive' : 'amount-negative';
    //     const amountPrefix = transaction.type === 'ADD' ? '+' : '-';
        
    //     const formattedDate = new Date(transaction.createdAt).toLocaleString('en-IN', {
    //       year: 'numeric',
    //       month: 'short',
    //       day: 'numeric',
    //       hour: '2-digit',
    //       minute: '2-digit'
    //     });

    //     row.innerHTML = `
    //       <td>${transaction.name}</td>
    //       <td><span class="${amountClass}">${amountPrefix}₹${transaction.amount.toLocaleString('en-IN')}</span></td>
    //       <td><span class="type-badge ${typeClass}">${transaction.type}</span></td>
    //       <td>${transaction.reason}</td>
    //       <td>${formattedDate}</td>
    //     `;
        
    //     tbody.appendChild(row);
    //   });
    // }

    // function createPagination(data) {
    //   const paginationNav = document.getElementById('pagination-nav');
    //   paginationNav.innerHTML = '';

    //   // Update pagination info
    //   const startRecord = data.pageNumber * data.pageSize + 1;
    //   const endRecord = Math.min((data.pageNumber + 1) * data.pageSize, data.totalElements);
    //   document.getElementById('start-record').textContent = startRecord;
    //   document.getElementById('end-record').textContent = endRecord;
    //   document.getElementById('total-records').textContent = data.totalElements;

    //   // Previous button
    //   const prevBtn = document.createElement('a');
    //   prevBtn.href = '#';
    //   prevBtn.className = 'pagination-nav-item rounded-l';
    //   prevBtn.innerHTML = `
    //     <svg class="icon" viewBox="0 0 20 20" fill="currentColor">
    //       <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
    //     </svg>
    //   `;
    //   if (data.pageNumber === 0) {
    //     prevBtn.style.pointerEvents = 'none';
    //     prevBtn.style.opacity = '0.5';
    //   } else {
    //     prevBtn.onclick = (e) => {
    //       e.preventDefault();
    //       currentPage = data.pageNumber - 1;
    //       fetchTransactions(currentPage);
    //     };
    //   }
    //   paginationNav.appendChild(prevBtn);

    //   // Page number buttons
    //   for (let i = 0; i < data.totalPages; i++) {
    //     // Show all pages if total pages <= 7
    //     // Otherwise show first, last, current and nearby pages
    //     const shouldShow = data.totalPages <= 7 || 
    //                       i === 0 || 
    //                       i === data.totalPages - 1 || 
    //                       (i >= data.pageNumber - 1 && i <= data.pageNumber + 1);

    //     if (shouldShow) {
    //       const pageBtn = document.createElement('a');
    //       pageBtn.href = '#';
    //       pageBtn.className = 'pagination-nav-item';
    //       if (i === data.pageNumber) {
    //         pageBtn.classList.add('current-page');
    //       }
    //       pageBtn.textContent = i + 1;
    //       pageBtn.onclick = (e) => {
    //         e.preventDefault();
    //         currentPage = i;
    //         fetchTransactions(currentPage);
    //       };
    //       paginationNav.appendChild(pageBtn);
    //     } else if (i === data.pageNumber - 2 || i === data.pageNumber + 2) {
    //       // Add ellipsis
    //       const ellipsis = document.createElement('span');
    //       ellipsis.className = 'pagination-ellipsis';
    //       ellipsis.textContent = '...';
    //       paginationNav.appendChild(ellipsis);
    //     }
    //   }

    //   // Next button
    //   const nextBtn = document.createElement('a');
    //   nextBtn.href = '#';
    //   nextBtn.className = 'pagination-nav-item rounded-r';
    //   nextBtn.innerHTML = `
    //     <svg class="icon" viewBox="0 0 20 20" fill="currentColor">
    //       <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
    //     </svg>
    //   `;
    //   if (data.last) {
    //     nextBtn.style.pointerEvents = 'none';
    //     nextBtn.style.opacity = '0.5';
    //   } else {
    //     nextBtn.onclick = (e) => {
    //       e.preventDefault();
    //       currentPage = data.pageNumber + 1;
    //       fetchTransactions(currentPage);
    //     };
    //   }
    //   paginationNav.appendChild(nextBtn);

    //   // Mobile pagination
    //   const prevMobile = document.getElementById('prev-mobile');
    //   const nextMobile = document.getElementById('next-mobile');

    //   if (data.pageNumber === 0) {
    //     prevMobile.style.pointerEvents = 'none';
    //     prevMobile.style.opacity = '0.5';
    //   } else {
    //     prevMobile.style.pointerEvents = 'auto';
    //     prevMobile.style.opacity = '1';
    //     prevMobile.onclick = (e) => {
    //       e.preventDefault();
    //       currentPage = data.pageNumber - 1;
    //       fetchTransactions(currentPage);
    //     };
    //   }

    //   if (data.last) {
    //     nextMobile.style.pointerEvents = 'none';
    //     nextMobile.style.opacity = '0.5';
    //   } else {
    //     nextMobile.style.pointerEvents = 'auto';
    //     nextMobile.style.opacity = '1';
    //     nextMobile.onclick = (e) => {
    //       e.preventDefault();
    //       currentPage = data.pageNumber + 1;
    //       fetchTransactions(currentPage);
    //     };
    //   }
    // }

    // // Load first page on page load
    // fetchTransactions(currentPage);

const API_BASE_URL = "http://localhost:8081";
const AUTH_TOKEN_KEY = "token";
let currentPage = 0;
const pageSize = 10;

async function fetchTransactions(page = 0) {
  try {
    document.getElementById("loading").style.display = "block";
    document.getElementById("error").style.display = "none";
    document.getElementById("transaction-content").style.display = "none";

    const token = localStorage.getItem(AUTH_TOKEN_KEY);

    if (!token) {
      throw new Error("Login required!");
    }

    const response = await fetch(
      `${API_BASE_URL}/transaction/${page}/${pageSize}`,
      {
        method: "GET",
        headers: {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json"
        }
      }
    );

    if (!response.ok) {
      throw new Error("Failed to load data!");
    }

    const data = await response.json();
    renderTable(data.content);
    updatePagination(data);

    currentPage = data.pageNumber;

    document.getElementById("loading").style.display = "none";
    document.getElementById("transaction-content").style.display = "block";

  } catch (err) {
    document.getElementById("loading").style.display = "none";
    document.getElementById("error").style.display = "block";
    document.getElementById("error").textContent = err.message;
  }
}

function renderTable(list) {
  const tbody = document.getElementById("transaction-body");
  tbody.innerHTML = "";

  if (!list || list.length === 0) {
    tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding: 1rem;">No Transactions Found</td></tr>`;
    return;
  }

  list.forEach(tx => {
    const dateFormatted = new Date(tx.createdAt).toLocaleString('en-IN', {
      year: 'numeric', month: 'short', day: 'numeric',
      hour: '2-digit', minute: '2-digit'
    });

    const typeClass = tx.type === 'ADD' ? 'type-add' : 'type-withdraw';
    const amountClass = tx.type === 'ADD' ? 'amount-positive' : 'amount-negative';
    const prefix = tx.type === 'ADD' ? '+' : '-';

    const row = `
      <tr>
        <td>${tx.name}</td>
        <td><span class="${amountClass}">${prefix}₹${tx.amount}</span></td>
        <td><span class="type-badge ${typeClass}">${tx.type}</span></td>
        <td>${tx.reason}</td>
        <td>${dateFormatted}</td>
      </tr>
    `;
    tbody.innerHTML += row;
  });
}

function updatePagination(data) {
  const totalRecords = data.totalElements;
  const startRecord = data.pageNumber * data.pageSize + 1;
  const endRecord = Math.min((data.pageNumber + 1) * data.pageSize, totalRecords);

  document.getElementById("start-record").textContent = startRecord;
  document.getElementById("end-record").textContent = endRecord;
  document.getElementById("total-records").textContent = totalRecords;

  document.getElementById("prev-mobile").onclick = () => {
    if (!data.first) fetchTransactions(currentPage - 1);
  };
  document.getElementById("next-mobile").onclick = () => {
    if (!data.last) fetchTransactions(currentPage + 1);
  };

  const paginationNav = document.getElementById("pagination-nav");
  paginationNav.innerHTML = "";

  // Prev
  paginationNav.innerHTML += `
    <a class="pagination-nav-item rounded-l" style="${data.first ? 'pointer-events:none;opacity:0.5;' : ''}"
    onclick="!${data.first} && fetchTransactions(${data.pageNumber - 1})">
      ‹
    </a>`;

  for (let i = 0; i < data.totalPages; i++) {
    paginationNav.innerHTML += `
      <a class="pagination-nav-item ${i === data.pageNumber ? 'current-page' : ''}"
      onclick="fetchTransactions(${i})">${i + 1}</a>`;
  }

  // Next
  paginationNav.innerHTML += `
    <a class="pagination-nav-item rounded-r" style="${data.last ? 'pointer-events:none;opacity:0.5;' : ''}"
    onclick="!${data.last} && fetchTransactions(${data.pageNumber + 1})">
      ›
    </a>`;
}

// First load
fetchTransactions(currentPage);



  </script>
</body>
</html>